<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Australian Visa Outcomes & NOM (2014–2024)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vega libs (order matters) -->
  <script defer src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#121317; --muted:#61646b; --brand:#2563eb;
      --ring:#e6e9f2; --accent:#eef2ff; --success:#10b981; --warn:#f59e0b; --alert:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.55 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    header{
      max-width:1200px; margin:32px auto 8px; padding:0 20px;
    }
    h1{font-size:clamp(28px,4vw,40px); margin:0 0 6px; letter-spacing:.2px}
    .subtitle{color:var(--muted); margin:0 0 20px}
    .key-findings{
      max-width:1200px; margin:0 auto 20px; padding:0 20px;
      display:grid; grid-template-columns:repeat(12,1fr); gap:16px;
    }
    .finding{
      grid-column:span 4; background:var(--card); border-radius:14px; padding:16px 16px;
      box-shadow:0 1px 2px rgba(0,0,0,.05); border:1px solid var(--ring);
    }
    .finding h3{margin:0 0 6px; font-size:16px}
    .finding p{margin:0; color:var(--muted); font-size:14px}
    .container{max-width:1200px; margin:0 auto 36px; padding:0 20px}
    .card{
      background:var(--card); border:1px solid var(--ring); border-radius:16px;
      padding:16px 16px 10px; margin:18px 0 26px; box-shadow:0 2px 6px rgba(0,0,0,.04);
    }
    h2{margin:0 0 12px; font-size:clamp(20px,2.6vw,28px)}
    figure{margin:0}
    .viz{width:100%; min-height:280px; border-radius:10px}
    figcaption{margin:10px 0 2px; color:var(--muted); font-size:14px}
    .story{
      margin-top:8px; background:var(--accent); border:1px solid #dbe5ff;
      padding:12px 12px; border-radius:12px; color:#334155; font-size:14px;
    }
    .foot{max-width:1200px; margin:8px auto 40px; padding:0 20px; color:var(--muted); font-size:14px}

    /* responsive grid collapse */
    @media (max-width:980px){
      .finding{grid-column:span 6}
    }
    @media (max-width:640px){
      .finding{grid-column:span 12}
    }
  </style>
</head>
<body>
  <header>
    <h1>Australian Visa Outcomes & Net Overseas Migration</h1>
    <p class="subtitle">2014–2024 | Five visuals, one story: pandemic shock → catch-up rebound → stabilisation & settlement patterns</p>
  </header>

  <!-- Key findings (headline takeaways) -->
  <section class="key-findings" aria-label="Key findings">
    <article class="finding">
      <h3>1) Rebound after restrictions</h3>
      <p>Visa outcomes dipped through 2019–22, then surged in 2022–23 as processing caught up and intake targets rose.</p>
    </article>
    <article class="finding">
      <h3>2) Skilled share normalises</h3>
      <p>Within the Migration program, the Skilled category lost share during border controls but recovered by 2022–23.</p>
    </article>
    <article class="finding">
      <h3>3) Where migrants come & settle</h3>
      <p>India and China lead recent NOM inflows. Settlements concentrate in NSW & VIC—the major job/education hubs.</p>
    </article>
  </section>

  <main class="container" id="main">
    <!-- 1) Line -->
    <section class="card" aria-labelledby="h2-line">
      <h2 id="h2-line">1) Total Visa Outcomes by Program</h2>
      <figure>
        <div id="vis-line" class="viz" role="img" aria-label="Visa outcomes line chart"></div>
        <figcaption>Click the legend to highlight a program. The dashed rule marks 2022–23 (rebound).</figcaption>
        <div class="story">
          Pre-COVID levels held steady before the pandemic suppressed outcomes through <strong>2019–20→2021–22</strong>.  
          The system then <strong>snapped back in 2022–23</strong> as backlogs cleared, setting the stage for today’s stabilisation.  
          This aggregate turn is the starting point for the rest of our story.
        </div>
      </figure>
    </section>

    <!-- 2) Normalized stacked -->
    <section class="card" aria-labelledby="h2-stacked">
      <h2 id="h2-stacked">2) Migration Program – Category Composition</h2>
      <figure>
        <div id="vis-stacked" class="viz" role="img" aria-label="Migration program composition"></div>
        <figcaption>Each bar is 100%. Hover for exact share by category.</figcaption>
        <div class="story">
          Under restrictions the <strong>Family stream</strong> temporarily took a larger share while <strong>Skilled</strong> shrank.  
          As borders reopened, Skilled regained weight—linking the rebound to labour-market needs.  
          That shift helps explain where new arrivals come from next.
        </div>
      </figure>
    </section>

    <!-- 3) Choropleth -->
    <section class="card" aria-labelledby="h2-map">
      <h2 id="h2-map">3) Net Overseas Migration by Country </h2>
      <figure>
        <div id="vis-map" class="viz" role="img" aria-label="World map of NOM by country"></div>
        <figcaption>Darker shading indicates higher positive NOM; hover to read exact values.</figcaption>
        <div class="story">
         Flows re-concentrate in the <strong>Asia–Pacific</strong>, especially <strong>India</strong> and <strong>China</strong>.  
          This global footprint channels directly into the top-country ranking below.
        </div>        
      </figure>
    </section>

    <!-- 4) Top10 -->
    <section class="card" aria-labelledby="h2-top10">
      <h2 id="h2-top10">4) Top 10 Source Countries by Net Overseas Migration</h2>
      <figure>
        <div id="vis-top10" class="viz" role="img" aria-label="Top 10 countries by NOM"></div>
        <figcaption>Latest year only; sorted descending. Legend omitted for clarity.</figcaption>
        <div class="story">
         <strong>India</strong> leads by a wide margin; <strong>China</strong> remains significant;  
          <strong>Philippines</strong>, <strong>Vietnam</strong>, <strong>Nepal</strong> underline a diversified Asian pipeline.  
          The next question is: where do these arrivals settle?
        </div>
      </figure>
    </section>

    <!-- 5) State-level NOM -->
    <section class="card" aria-labelledby="h2-state">
      <h2 id="h2-state">5) Where do migrants settle? </h2>
      <figure>
        <div id="vis-state-nom" class="viz" role="img" aria-label="State-level NOM"></div>
        <figcaption>Bar shows absolute NOM; donut summarises share of total NOM.</figcaption>
        <div class="story">
         Settlement is <strong>urban-centric</strong>: <strong>NSW</strong> and <strong>VIC</strong> absorb the majority, reflecting job density, education capacity and diaspora networks.  
          The national rebound ultimately materialises in these urban systems—where housing and infrastructure will feel it most.
        </div>
      </figure>
    </section>
  </main>

  <footer class="foot">
    Data: Department of Home Affairs (visa outcomes), NOM; Natural Earth (basemap). Visuals built with Vega-Lite.
  </footer>

  <script>
    // Wait for vega libs to be ready (defer loaded)
    window.addEventListener('load', () => {
      const EMBED_OPTS = { renderer: 'svg', actions: {export:true, source:false, editor:false} };

      // Helper to embed & auto-resize (fit to container width)
      const fitEmbed = (el, specUrl) => {
        const host = document.querySelector(el);
        const embed = () => vegaEmbed(host, specUrl, EMBED_OPTS).then(res => {
          // Resize on container change
          const ro = new ResizeObserver(() => { try { res.view.resize(); } catch(e){} });
          ro.observe(host);
        }).catch(console.error);
        // Lazy load when visible
        const io = new IntersectionObserver((entries) => {
          entries.forEach(en => { if (en.isIntersecting) { embed(); io.disconnect(); }});
        }, {rootMargin: '200px 0px'});
        io.observe(host);
      };

      fitEmbed('#vis-line',      'charts/gov_line_total.json');
      fitEmbed('#vis-stacked',   'charts/gov_stacked_category.json');
      fitEmbed('#vis-map',       'charts/nom_map.json');
      fitEmbed('#vis-top10',     'charts/nom_top10.json');
      fitEmbed('#vis-state-nom', 'charts/state_nom_map.json');
    });
  </script>
</body>
</html>
